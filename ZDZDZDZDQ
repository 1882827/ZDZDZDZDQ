local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local whitelist = {
    ["SadNii4"] = true,
    ["82iwkwjw3"] = true,
    ["EternaIKing_ofc"] = true,
    ["EternalQueen_ofc"] = true,
    ["OfEternal_king"] = true,
    ["OfEternal_queen"] = true,
    ["PROPLAYER292827"] = true,
    ["ilvieharbor73"] = true,
    ["TOQUIO_94"] = true,
    ["TOQUIO_944"] = true,
    ["ARMY_S0LDIER8"] = true,
    ["dorrido13"] = true,
    ["PEBUGADOTUTORIAL"] = true,
    ["TheLittle8Prince"] = true,
    ["Italo444hzx"] = true,
    ["NOOB_SEUPESADELO"] = true,
    ["Voa_Passarinho8"] = true,
    ["SadNii0"] = true,
    ["NeezXIX"] = true,
    ["Nicke_Nii"] = true,
    ["KillMachineFatality"] = true,
    ["Kansas_Girl8"] = true,
    ["Maveick01"] = true,
    ["XXDuquesa_julianaXX"] = true,
    ["User25"] = true,
    ["User26"] = true,
    ["User27"] = true,
    ["User28"] = true,
    ["User29"] = true,
    ["User30"] = true,
    ["User31"] = true,
    ["User32"] = true,
    ["User33"] = true,
    ["User34"] = true,
    ["User35"] = true,
    ["User36"] = true,
    ["User37"] = true,
    ["User38"] = true,
    ["User39"] = true
}

if not whitelist[LocalPlayer.Name] then
    LocalPlayer:Kick("Voce nao esta na whitelist para usar este script.")
    return
end

print("Usuario autorizado:", LocalPlayer.Name)

local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/MlFrvWM/BBLT81/main/BL81827TC", true))()

local window = library:AddWindow("Sad | Boost Gifter", {
    main_color = Color3.fromRGB(61, 10, 161),
    min_size = Vector2.new(505, 420),
    can_resize = false,
})

local GifterTab = window:AddTab("Gifter")

local Machine = GifterTab:AddLabel("Machine To Send Boost(s)")
Machine.TextColor3 = Color3.fromRGB(107, 0, 255)
Machine.TextSize = 25

local proteinEggLabel = GifterTab:AddLabel("Protein Eggs: 0")
proteinEggLabel.TextSize = 20
local tropicalShakeLabel = GifterTab:AddLabel("Tropical Shakes: 0")
tropicalShakeLabel.TextSize = 18

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Debug: Check if events exist
print("=== CHECKING GIFT EVENTS ===")

local giftRemote
local function findGiftEvent()
    -- First, try to find the specific event from the log
    if ReplicatedStorage:FindFirstChild("FEvents") then
        local FEvents = ReplicatedStorage:FindFirstChild("FEvents")
        if FEvents:FindFirstChild("giftRemote") then
            giftRemote = FEvents:FindFirstChild("giftRemote")
            print("Event found: ReplicatedStorage.FEvents.giftRemote")
            return true
        end
    end
    
    -- If not found, search for any remote related to gifts
    for _, child in pairs(ReplicatedStorage:GetDescendants()) do
        if (child:IsA("RemoteEvent") or child:IsA("RemoteFunction")) and 
           (string.find(string.lower(child.Name), "gift") or 
            string.find(string.lower(child.Name), "present")) then
            giftRemote = child
            print("Alternative event found: " .. child:GetFullName())
            return true
        end
    end
    
    warn("No gift event found!")
    return false
end

local eventFound = findGiftEvent()

local selectedPlayerEgg = nil
local eggCount = 0
local isGiftingEggs = false

local selectedPlayerShake = nil
local shakeCount = 0
local isGiftingShakes = false

local function updateItemCount()
    local proteinEggCount = 0
    local tropicalShakeCount = 0

    local backpack = Players.LocalPlayer:WaitForChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            if item.Name == "Protein Egg" then
                proteinEggCount = proteinEggCount + 1
            elseif item.Name == "Tropical Shake" then
                tropicalShakeCount = tropicalShakeCount + 1
            end
        end
    end

    proteinEggLabel.Text = "Protein Eggs: " .. proteinEggCount
    tropicalShakeLabel.Text = "Tropical Shakes: " .. tropicalShakeCount
end

task.spawn(function()
    while true do
        updateItemCount()
        task.wait(7.5)
    end
end)

GifterTab:AddLabel("Protein Egg Gifter").TextSize = 20

local playerDropdownEgg = GifterTab:AddDropdown("Choose Player for Eggs", function(name)
    selectedPlayerEgg = Players:FindFirstChild(name)
    if selectedPlayerEgg then
        print("Player selected for eggs: " .. selectedPlayerEgg.Name)
    end
end)

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= Players.LocalPlayer then
        playerDropdownEgg:Add(player.Name)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= Players.LocalPlayer then
        playerDropdownEgg:Add(player.Name)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    playerDropdownEgg:Remove(player.Name)
    if selectedPlayerEgg == player then
        selectedPlayerEgg = nil
    end
end)

GifterTab:AddTextBox("Egg Amount", function(Text)
    eggCount = tonumber(Text) or 0
    print("Egg quantity set: " .. eggCount)
end)

local eggGiftButton = GifterTab:AddButton("Send Protein Eggs", function()
    if isGiftingEggs then
        isGiftingEggs = false
        eggGiftButton.Text = "Send Protein Eggs"
        print("Stopping egg sending...")
        return
    end
    
    if selectedPlayerEgg and eggCount and eggCount > 0 and giftRemote then
        isGiftingEggs = true
        eggGiftButton.Text = "Stop Sending Eggs"
        
        local successCount = 0
        local failCount = 0
        
        print("Starting to send " .. eggCount .. " eggs to " .. selectedPlayerEgg.Name)
        
        for i = 1, eggCount do
            if not isGiftingEggs then break end
            
            local success, errorMsg = pcall(function()
                -- Try different argument formats for the gift event
                local args = {"Protein Egg", selectedPlayerEgg}
                local success1 = pcall(function()
                    giftRemote:FireServer(unpack(args))
                end)
                
                if not success1 then
                    local success2 = pcall(function()
                        giftRemote:InvokeServer(unpack(args))
                    end)
                    
                    if not success2 then
                        -- Try reverse order
                        local argsReverse = {selectedPlayerEgg, "Protein Egg"}
                        local success3 = pcall(function()
                            giftRemote:FireServer(unpack(argsReverse))
                        end)
                        
                        if not success3 then
                            giftRemote:InvokeServer(unpack(argsReverse))
                        end
                    end
                end
            end)
            
            if success then
                successCount = successCount + 1
                print("Successfully sent egg " .. i .. "/" .. eggCount)
            else
                failCount = failCount + 1
                warn("Error sending egg: " .. tostring(errorMsg))
            end
            
            task.wait(0.5)
        end
        
        isGiftingEggs = false
        eggGiftButton.Text = "Send Protein Eggs"
        print("Finished sending eggs. Success: " .. successCount .. ", Failed: " .. failCount)
    else
        if not giftRemote then
            warn("ERROR: No gift event found!")
        else
            warn("Please select a player and enter a valid amount of eggs")
        end
    end
end)

GifterTab:AddLabel("Tropical Shake Gifter").TextSize = 20

local playerDropdownShake = GifterTab:AddDropdown("Choose Player for Shakes", function(name)
    selectedPlayerShake = Players:FindFirstChild(name)
    if selectedPlayerShake then
        print("Player selected for shakes: " .. selectedPlayerShake.Name)
    end
end)

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= Players.LocalPlayer then
        playerDropdownShake:Add(player.Name)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= Players.LocalPlayer then
        playerDropdownShake:Add(player.Name)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    playerDropdownShake:Remove(player.Name)
    if selectedPlayerShake == player then
        selectedPlayerShake = nil
    end
end)

GifterTab:AddTextBox("Shake Amount", function(Text)
    shakeCount = tonumber(Text) or 0
    print("Shake quantity set: " .. shakeCount)
end)

local shakeGiftButton = GifterTab:AddButton("Send Tropical Shakes", function()
    if isGiftingShakes then
        isGiftingShakes = false
        shakeGiftButton.Text = "Send Tropical Shakes"
        print("Stopping shake sending...")
        return
    end
    
    if selectedPlayerShake and shakeCount and shakeCount > 0 and giftRemote then
        isGiftingShakes = true
        shakeGiftButton.Text = "Stop Sending Shakes"
        
        local successCount = 0
        local failCount = 0
        
        print("Starting to send " .. shakeCount .. " shakes to " .. selectedPlayerShake.Name)
        
        for i = 1, shakeCount do
            if not isGiftingShakes then break end
            
            local success, errorMsg = pcall(function()
                -- Try different argument formats for the gift event
                local args = {"Tropical Shake", selectedPlayerShake}
                local success1 = pcall(function()
                    giftRemote:FireServer(unpack(args))
                end)
                
                if not success1 then
                    local success2 = pcall(function()
                        giftRemote:InvokeServer(unpack(args))
                    end)
                    
                    if not success2 then
                        -- Try reverse order
                        local argsReverse = {selectedPlayerShake, "Tropical Shake"}
                        local success3 = pcall(function()
                            giftRemote:FireServer(unpack(argsReverse))
                        end)
                        
                        if not success3 then
                            giftRemote:InvokeServer(unpack(argsReverse))
                        end
                    end
                end
            end)
            
            if success then
                successCount = successCount + 1
                print("Successfully sent shake " .. i .. "/" .. shakeCount)
            else
                failCount = failCount + 1
                warn("Error sending shake: " .. tostring(errorMsg))
            end
            
            task.wait(0.5)
        end
        
        isGiftingShakes = false
        shakeGiftButton.Text = "Send Tropical Shakes"
        print("Finished sending shakes. Success: " .. successCount .. ", Failed: " .. failCount)
    else
        if not giftRemote then
            warn("ERROR: No gift event found!")
        else
            warn("Please select a player and enter a valid amount of shakes")
        end
    end
end)

if eventFound then
    print("Gift system initialized successfully with event: " .. giftRemote:GetFullName())
else
    warn("WARNING: Gift system initialized but no gift event was found!")
    print("Please check if the game has a different event name for gifting")
end
